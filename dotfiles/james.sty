% Actual Located in C:\texlive\2018\texmf-dist\tex\latex\james.sty
\ProvidesPackage{james}

% Conditionals
\newif\ifjameshmwk \jameshmwkfalse
\newif\ifjamesnotes \jamesnotestrue

\newif\ifjamespkg \jamespkgtrue

\newif\ifjamesthm \jamesthmtrue
\newif\ifjamessecthm \jamessecthmfalse
\newif\ifjamesmdthm \jamesmdthmfalse

\newif\ifjamescolorsec \jamescolorsecfalse
\newif\ifjameshref\jameshreftrue

% Options
\DeclareOption{hmwk}{\jameshmwktrue\jameshreffalse\jamesthmfalse}
\DeclareOption{notes}{\jamesnotestrue}
\DeclareOption{nopkg}{\jamespkgfalse}
\DeclareOption{sexy}{\jamessecthmtrue\jamesmdthmtrue\jamescolorsectrue}
\ProcessOptions\relax

\ifjamespkg
	\usepackage{amsmath,amssymb}
\fi

% CUSTOM MACROS

\newcommand{\N}{\mathbb{N}}
\newcommand{\Z}{\mathbb{Z}}
\newcommand{\Q}{\mathbb{Q}}
\newcommand{\R}{\mathbb{R}}
\newcommand{\nullset}{\varnothing}
\newcommand{\WLOG}{\textrm{\emph{w.l.o.g.}}}
\newcommand{\by}[2]{\overset{#1}{#2}}

\newcommand{\dlim}{\lim\limits} % displaystyle limits in-text
\newcommand{\cR}{\mathcal{R}}

\newcommand{\dint}{\displaystyle\int} % displaystyle integrals in-text
\newcommand{\cbrt}[1]{\sqrt[3]{#1}}
\newcommand{\floor}[1]{\left\lfloor #1 \right\rfloor}
\newcommand{\ceiling}[1]{\left\lceil #1 \right\rceil}
\newcommand{\mailto}[1]{\href{mailto:#1}{\texttt{#1}}}
\newcommand{\ol}{\overline}
\newcommand{\ul}{\underline}
\newcommand{\wt}{\widetilde}
\newcommand{\wh}{\widehat}
\newcommand{\vocab}[1]{\textbf{\color{blue} #1}}
\providecommand{\alert}{\vocab}
\providecommand{\half}{\frac{1}{2}}
\newcommand{\catname}{\mathsf}
\newcommand{\hrulebar}{
  \par\hspace{\fill}\rule{0.95\linewidth}{.7pt}\hspace{\fill}
  \par\nointerlineskip \vspace{\baselineskip}
}

%More commands and math operators
\DeclareMathOperator{\cis}{cis}
\DeclareMathOperator*{\lcm}{lcm}
\DeclareMathOperator*{\argmin}{arg min}
\DeclareMathOperator*{\argmax}{arg max}

%Convenient Environments
\newenvironment{soln}{\begin{proof}[Solution]}{\end{proof}}
\newenvironment{parlist}{\begin{inparaenum}[(i)]}{\end{inparaenum}}
\newenvironment{gobble}{\setbox\z@\vbox\bgroup}{\egroup}

%Inequalities
\newcommand{\cycsum}{\sum_{\mathrm{cyc}}}
\newcommand{\symsum}{\sum_{\mathrm{sym}}}
\newcommand{\cycprod}{\prod_{\mathrm{cyc}}}
\newcommand{\symprod}{\prod_{\mathrm{sym}}}

%Geometry
\newcommand{\abs}[1]{\left\lvert #1 \right\rvert}
\newcommand{\norm}[1]{\left\lVert #1 \right\rVert}
\newcommand{\dang}{\measuredangle} %% Directed angle
\newcommand{\ray}[1]{\overrightarrow{#1}}
\newcommand{\seg}[1]{\overline{#1}}
\newcommand{\arc}[1]{\wideparen{#1}}

% From Math 55 and Math 145 at Harvard
\newenvironment{subproof}[1][Proof]{%
\begin{proof}[#1] \renewcommand{\qedsymbol}{$\blacksquare$}}%
{\end{proof}}

\newcommand{\liff}{\leftrightarrow}
\newcommand{\lthen}{\rightarrow}
\newcommand{\opname}{\operatorname}
\newcommand{\surjto}{\twoheadrightarrow}
\newcommand{\injto}{\hookrightarrow}
\newcommand{\On}{\mathrm{On}} % ordinals
\DeclareMathOperator{\img}{im} % Image
\DeclareMathOperator{\Img}{Im} % Image
\DeclareMathOperator{\coker}{coker} % Cokernel
\DeclareMathOperator{\Coker}{Coker} % Cokernel
\DeclareMathOperator{\Ker}{Ker} % Kernel
\DeclareMathOperator{\rank}{rank}
\DeclareMathOperator{\Spec}{Spec} % spectrum
\DeclareMathOperator{\Tr}{Tr} % trace
\DeclareMathOperator{\pr}{pr} % projection
\DeclareMathOperator{\ext}{ext} % extension
\DeclareMathOperator{\pred}{pred} % predecessor
\DeclareMathOperator{\dom}{dom} % domain
\DeclareMathOperator{\ran}{ran} % range
\DeclareMathOperator{\Hom}{Hom} % homomorphism
\DeclareMathOperator{\Mor}{Mor} % morphisms
\DeclareMathOperator{\End}{End} % endomorphism

% More script letters etc.
\newcommand{\SA}{\mathcal A}
\newcommand{\SB}{\mathcal B}
\newcommand{\SC}{\mathcal C}
\newcommand{\SF}{\mathcal F}
\newcommand{\SG}{\mathcal G}
\newcommand{\SH}{\mathcal H}
\newcommand{\OO}{\mathcal O}

\newcommand{\SCA}{\mathscr A}
\newcommand{\SCB}{\mathscr B}
\newcommand{\SCC}{\mathscr C}
\newcommand{\SCD}{\mathscr D}
\newcommand{\SCE}{\mathscr E}
\newcommand{\SCF}{\mathscr F}
\newcommand{\SCG}{\mathscr G}
\newcommand{\SCH}{\mathscr H}

% Mathfrak primes
\newcommand{\km}{\mathfrak m}
\newcommand{\kp}{\mathfrak p}
\newcommand{\kq}{\mathfrak q}

\ifjamespkg
  \PassOptionsToPackage{usenames,svgnames,dvipsnames}{xcolor}
  \usepackage{xcolor}
  \ifjameshref
    \usepackage[colorlinks=true]{hyperref}
    \hypersetup{urlcolor=RubineRed,linkcolor=RoyalBlue,citecolor=ForestGreen}
  \fi
  \usepackage[nameinlink]{cleveref}
\fi


%% COND: New Theorem Styles
\ifjamesthm
  \usepackage{amsthm}
\fi
\ifjamesmdthm
  \usepackage{amsthm} % needed for nothm+mdthm
  \usepackage{thmtools}
  \usepackage[framemethod=TikZ]{mdframed}

  \mdfdefinestyle{mdbluebox}{%
    roundcorner = 10pt,
    linewidth=1pt,
    skipabove=12pt,
    innerbottommargin=9pt,
    skipbelow=2pt,
    linecolor=blue,
    nobreak=true,
    backgroundcolor=TealBlue!5,
  }
  \declaretheoremstyle[
    headfont=\sffamily\bfseries\color{MidnightBlue},
    mdframed={style=mdbluebox},
    headpunct={\\[3pt]},
    postheadspace={0pt}
  ]{thmbluebox}

  \mdfdefinestyle{mdredbox}{%
    linewidth=0.5pt,
    skipabove=12pt,
    frametitleaboveskip=5pt,
    frametitlebelowskip=0pt,
    skipbelow=2pt,
    frametitlefont=\bfseries,
    innertopmargin=4pt,
    innerbottommargin=8pt,
    nobreak=true,
    backgroundcolor=Salmon!5,
    linecolor=RawSienna,
  }
  \declaretheoremstyle[
    headfont=\bfseries\color{RawSienna},
    mdframed={style=mdredbox},
    headpunct={\\[3pt]},
    postheadspace={0pt},
  ]{thmredbox}

  \mdfdefinestyle{mdgreenbox}{%
    skipabove=8pt,
    linewidth=2pt,
    rightline=false,
    leftline=true,
    topline=false,
    bottomline=false,
    linecolor=ForestGreen,
    backgroundcolor=ForestGreen!5,
  }
  \declaretheoremstyle[
    headfont=\bfseries\sffamily\color{ForestGreen!70!black},
    bodyfont=\normalfont,
    spaceabove=2pt,
    spacebelow=1pt,
    mdframed={style=mdgreenbox},
    headpunct={ --- },
  ]{thmgreenbox}

  \mdfdefinestyle{mdblackbox}{%
    skipabove=8pt,
    linewidth=3pt,
    rightline=false,
    leftline=true,
    topline=false,
    bottomline=false,
    linecolor=black,
    backgroundcolor=RedViolet!5!gray!5,
  }
  \declaretheoremstyle[
    headfont=\bfseries,
    bodyfont=\normalfont\small,
    spaceabove=0pt,
    spacebelow=0pt,
    mdframed={style=mdblackbox}
  ]{thmblackbox}

  \newcommand{\listhack}{$\empty$\vspace{-2em}}
\fi

%% COND:  Theorem setup
\ifjamesthm
  \theoremstyle{plain}
  %Branching here: the option secthm changes theorems to be labelled by section
  \ifjamesmdthm
    \ifjamessecthm
      \declaretheorem[%
      style=thmbluebox,name=Theorem,numberwithin=section]{theorem}
    \else
      \declaretheorem[%
      style=thmbluebox,name=Theorem]{theorem}
    \fi
    \declaretheorem[style=thmbluebox,name=Lemma,sibling=theorem]{lemma}
    \declaretheorem[style=thmbluebox,name=Proposition,sibling=theorem]{proposition}
    \declaretheorem[style=thmbluebox,name=Corollary,sibling=theorem]{corollary}
    \declaretheorem[style=thmbluebox,name=Theorem,numbered=no]{theorem*}
    \declaretheorem[style=thmbluebox,name=Lemma,numbered=no]{lemma*}
    \declaretheorem[style=thmbluebox,name=Proposition,numbered=no]{proposition*}
    \declaretheorem[style=thmbluebox,name=Corollary,numbered=no]{corollary*}
  \else
    \ifjamessecthm
      \newtheorem{theorem}{Theorem}[section]
    \else
      \newtheorem{theorem}{Theorem}
    \fi
    \newtheorem{lemma}[theorem]{Lemma}
    \newtheorem{proposition}[theorem]{Proposition}
    \newtheorem{corollary}[theorem]{Corollary}
    \newtheorem*{theorem*}{Theorem}
    \newtheorem*{lemma*}{Lemma}
    \newtheorem*{proposition*}{Proposition}
    \newtheorem*{corollary*}{Corollary}
  \fi

  %Def-style theorems
  \theoremstyle{definition}

  % This ought to be a real theorem, but would be too much italics
  \ifjamesmdthm
    \declaretheorem[style=thmgreenbox,name=Algorithm,sibling=theorem]{algorithm}
    \declaretheorem[style=thmgreenbox,name=Algorithm,numbered=no]{algorithm*}
    \declaretheorem[style=thmgreenbox,name=Claim,sibling=theorem]{claim}
    \declaretheorem[style=thmgreenbox,name=Claim,numbered=no]{claim*}
  \else
    \newtheorem{algorithm}[theorem]{Algorithm}
    \newtheorem*{algorithm*}{Algorithm}
    \newtheorem{claim}[theorem]{Claim}
    \newtheorem*{claim*}{Claim}
  \fi

  \newtheorem{conjecture}[theorem]{Conjecture}
  \newtheorem{definition}[theorem]{Definition}
  \newtheorem{fact}[theorem]{Fact}
  \newtheorem{answer}[theorem]{Answer}
  \newtheorem{case}[theorem]{Case}
  \newtheorem{ques}[theorem]{Question}
  \newtheorem{exercise}[theorem]{Exercise}
  \newtheorem{problem}[theorem]{Problem}

  \newtheorem*{conjecture*}{Conjecture}
  \newtheorem*{definition*}{Definition}
  \newtheorem*{fact*}{Fact}
  \newtheorem*{answer*}{Answer}
  \newtheorem*{case*}{Case}
  \newtheorem*{joke*}{Joke}
  \newtheorem*{ques*}{Question}
  \newtheorem*{exercise*}{Exercise}
  \newtheorem*{problem*}{Problem}

  \ifjamesmdthm
    \declaretheorem[style=thmredbox,name=Example,sibling=theorem]{example}
    \declaretheorem[style=thmredbox,name=Example,numbered=no]{example*}
  \else
    \newtheorem{example}[theorem]{Example}
    \newtheorem*{example*}{Example}
  \fi

  % Remark-style theorems
  %\theoremstyle{remark}
  \ifjamesmdthm
    \declaretheorem[style=thmblackbox,name=Remark,sibling=theorem]{remark}
    \declaretheorem[style=thmblackbox,name=Remark,numbered=no]{remark*}
  \else
    \newtheorem{remark}[theorem]{Remark}
    \newtheorem*{remark*}{Remark}
  \fi
  \newtheorem{note}[theorem]{Note}
  \newtheorem*{note*}{Note}
  \newtheorem{abuse}[theorem]{Abuse of Notation}
  \newtheorem*{abuse*}{Abuse of Notation}
\fi


%% COND:  Fancy section and chapter heads
\ifjamescolorsec
  \@ifundefined{KOMAClassName}{}{
    \@ifundefined{chapter}{}{
      \addtokomafont{partprefix}{\rmfamily}
      \renewcommand*{\partformat}{\color{purple}
        \scalebox{2.5}{\thepart}\enlargethispage{2em}}
      \addtokomafont{chapterprefix}{\raggedleft}
      \RedeclareSectionCommand[beforeskip=0.5em]{chapter}
      \renewcommand*{\chapterformat}{\mbox{%
        \scalebox{1.5}{\chapappifchapterprefix{\nobreakspace}}%
        \scalebox{2.718}{\color{purple}\thechapter}\enskip}}
    }
    \renewcommand*{\sectionformat}%
      {\color{purple}\S\thesection\enskip}
    \renewcommand*{\subsectionformat}%
      {\color{purple}\S\thesubsection\enskip}
    \renewcommand*{\subsubsectionformat}%
      {\color{purple}\S\thesubsubsection\enskip}
    \KOMAoptions{numbers=noenddot}
    \usepackage[tocindentauto]{tocstyle}
    \usetocstyle{KOMAlike}
  }
\fi
